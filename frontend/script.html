<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Web de Favores</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <!-- React y ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  
  <!-- Babel (para JSX) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <style>
    /* Usar la fuente Inter como en el dise√±o original */
    body {
      font-family: "Inter", sans-serif;
    }

    /* Definiciones manuales para las animaciones de tailwindcss-animate */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes zoomIn95 {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
    @keyframes slideInFromLeft {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    @keyframes slideInFromBottom4 {
      from { opacity: 0; transform: translateY(16px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-in {
      animation-duration: 150ms;
      animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    }
    .fade-in { animation-name: fadeIn; }
    .zoom-in-95 { animation-name: zoomIn95; }
    .slide-in-from-left { animation-name: slideInFromLeft; }
    .slide-in-from-bottom-4 { animation-name: slideInFromBottom4; }
  </style>
</head>
<body>
  <!-- Contenedor ra√≠z para la app React -->
  <div id="root"></div>

  <!-- Script de React (JSX) -->
  <script type="text/babel">
    const { useState, useRef, useEffect } = React;
// --- 1. CONFIGURACI√ìN DEL BACKEND ---
    const API_BASE_URL = "http://127.0.0.1:8000/api";

    // Funci√≥n maestra para hablar con el servidor
    const apiCall = async (endpoint, method = 'GET', body = null) => {
      const token = localStorage.getItem('accessToken');
      const headers = {
        'Content-Type': 'application/json',
        ...(token && { 'Authorization': `Bearer ${token}` }) 
      };

      const config = {
        method,
        headers,
        ...(body && { body: JSON.stringify(body) })
      };

      try {
        const response = await fetch(`${API_BASE_URL}${endpoint}`, config);
        
        if (response.status === 401) {
           console.warn("Sesi√≥n expirada");
           localStorage.removeItem('accessToken');
        }
        
        if (response.status === 204) return true;
        
        const data = await response.json();
        if (!response.ok) throw new Error(data.detail || JSON.stringify(data));
        return data;
      } catch (error) {
        console.error("API Error:", error);
        throw error;
      }
    };
    // --- Componentes de Iconos (SVG en l√≠nea) ---
    // (A√±adidos Plus, Minus, Trash, Walk, Check, UserPlus)
    const IconProps = {
      className: "w-6 h-6 text-gray-700",
      strokeWidth: 2,
      fill: "none",
      stroke: "currentColor",
      strokeLinecap: "round",
      strokeLinejoin: "round",
    };
    const Menu = () => (
      <svg {...IconProps}><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
    );
    const ShoppingCart = () => (
      <svg {...IconProps}><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
    );
    const User = () => (
      <svg {...IconProps}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
    );
    const X = () => (
      <svg {...IconProps} className="w-5 h-5 text-gray-500"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
    );
    const ArrowLeft = () => (
      <svg {...IconProps}><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
    );
    const ChevronUp = () => (
      <svg {...IconProps} className="w-5 h-5"><polyline points="18 15 12 9 6 15"></polyline></svg>
    );
    const ChevronDown = () => (
      <svg {...IconProps} className="w-5 h-5 text-gray-400"><polyline points="6 9 12 15 18 9"></polyline></svg>
    );
    const ChevronRight = () => (
      <svg {...IconProps} className="w-5 h-5 text-gray-400"><polyline points="9 18 15 12 9 6"></polyline></svg>
    );
    const MapPin = ({ className }) => (
      <svg className={className} strokeWidth="1.5" fill="currentColor" viewBox="0 0 24 24"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
    );
    const Hand = ({ className }) => (
      <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0a2 2 0 0 0-2 2v0a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-5a2 2 0 0 0-2-2z"></path></svg>
    );
    const UserPlus = ({ className }) => (
      <svg className={className} strokeWidth="1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="8.5" cy="7" r="4"></circle><line x1="20" y1="8" x2="20" y2="14"></line><line x1="17" y1="11" x2="23" y2="11"></line></svg>
    );
    const Plus = ({ className }) => (
      <svg {...IconProps} className={className || "w-5 h-5"}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
    );
    const Minus = ({ className }) => (
       <svg {...IconProps} className={className || "w-5 h-5"}><line x1="5" y1="12" x2="19" y2="12"></line></svg>
    );
    const Trash = ({ className }) => (
      <svg {...IconProps} className={className || "w-6 h-6 text-gray-500 hover:text-red-600"}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
    );
    const Walk = ({ className }) => (
        <svg className={className} strokeWidth="2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M13 19l-4-4l-1-7h10l-1 7l-4 4z"></path><circle cx="12" cy="5" r="2"></circle></svg>
    );
    const Check = ({ className }) => (
        <svg className={className} strokeWidth="3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"></polyline></svg>
    );
    const HelpCircle = () => (
      <svg {...IconProps} className="w-5 h-5 text-white"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
    );
    const IdCard = ({ className }) => (
      // Icono de Carnet de Estudiante (similar al de la imagen)
      <svg className={className} strokeWidth="1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <rect x="3" y="5" width="18" height="14" rx="2"></rect>
        <circle cx="8" cy="10" r="2"></circle>
        <path d="M12 12c-2.5 0-5 1.5-5 3v2h10v-2c0-1.5-2.5-3-5-3z"></path>
        <line x1="14" y1="8" x2="19" y2="8"></line>
        <line x1="14" y1="11" x2="19" y2="11"></line>
      </svg>
    );


    // --- Componente: Men√∫ Desplegable Flotante ---
    function DropdownMenu({ options, onSelect }) {
      return (
        <div 
          className="absolute top-full left-0 mt-1 w-full bg-white rounded-lg shadow-2xl border border-gray-100 z-20 animate-in fade-in zoom-in-95"
        >
          <div className="py-1 max-h-48 overflow-y-auto">
            {options.map((option) => (
              <button
                key={option}
                onClick={() => onSelect(option)}
                className="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
              >
                {option}
              </button>
            ))}
          </div>
        </div>
      );
    }
    
    // --- Componente 2: Modal de Confirmaci√≥n (REUTILIZABLE) ---
    function ConfirmacionModal({ onClose, servicio, desde, hasta, hora, onConfirmAction }) {
      
      // --- L√≥gica de Precios (Simulada) ---
      // (Esta l√≥gica se podr√≠a pasar como prop si var√≠a mucho)
      const totalServicio = 1.50;
      const tarifaRepartidor = 2.25;
      const totalPagar = totalServicio + tarifaRepartidor;
      const [loading, setLoading] = useState(false);
      
      const handleFinalConfirm = async () => {
        if (!onConfirmAction) return; // Si no hay acci√≥n, solo cerramos (comportamiento antiguo)
        setLoading(true);
        try {
            await onConfirmAction(); // Ejecuta la funci√≥n que env√≠a al backend
            onClose(); // Cierra el modal solo si tuvo √©xito
        } catch (error) {
            console.error(error);
        } finally {
            setLoading(false);
        }
      };
      return (
        // Fondo semitransparente
        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4 animate-in fade-in">
          {/* Contenedor del Modal */}
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-md mx-auto relative p-6 sm:p-8 space-y-4 animate-in zoom-in-95">
            
            {/* Bot√≥n de Cierre (Icono X) */}
            <button
              onClick={onClose}
              className="absolute top-4 right-4 p-2 hover:bg-gray-100 rounded-full transition-colors"
            >
              <X />
            </button>

            {/* T√≠tulo */}
            <h2 className="text-2xl sm:text-3xl font-bold text-gray-800">
              Confirmar tu Pedido
            </h2>
            
            {/* Resumen del Pedido (DIN√ÅMICO) */}
            <div className="text-sm text-gray-600 space-y-1 pt-2">
              <p><strong className="text-gray-900">Servicio:</strong> {servicio || "No especificado"}</p>
              <p><strong className="text-gray-900">Desde:</strong> {desde || "No especificado"}</p>
              <p><strong className="text-gray-900">Hasta:</strong> {hasta || "No especificado"}</p>
              <p><strong className="text-gray-900">Hora:</strong> {hora || "No especificado"}</p>
            </div>

            {/* Secci√≥n "Monto a Pagar" (ACTUALIZADA) */}
            <div className="space-y-2 py-4 border-t">
              <h3 className="text-lg font-semibold text-gray-800">Monto a Pagar</h3>
              <div className="flex justify-between text-gray-700">
                <p>TOTAL</p>
                <p>${totalServicio.toFixed(2)}</p>
              </div>
              <div className="flex justify-between text-gray-700">
                <p>Tarifa del repartidor</p>
                <p>${tarifaRepartidor.toFixed(2)}</p>
              </div>
              
              {/* Divisor y Nuevo Total */}
              <div className="border-t border-gray-200 pt-2 mt-2"></div>
              <div className="flex justify-between text-xl font-bold text-black">
                <p>Total a pagar</p>
                <p>${totalPagar.toFixed(2)}</p>
              </div>
            </div>

            {/* Secci√≥n "M√©todos de Pagos" */}
            <div className="space-y-3 pb-4">
              <h3 className="text-lg font-semibold text-gray-800">M√©todos de Pagos</h3>
              <div className="bg-gray-100 border border-gray-200 rounded-lg p-3 flex items-center space-x-3">
                <span className="text-2xl">üíµ</span>
                <span className="font-medium text-gray-800">Efectivo</span>
              </div>
              <p className="text-xs text-gray-500">
                Pagar al repartidor al recibir el pedido
              </p>
            </div>

            {/* Bot√≥n de Confirmaci√≥n Final */}
            <button 
                onClick={handleFinalConfirm}
                disabled={loading}
                className="w-full bg-black text-white py-3 rounded-lg font-medium hover:bg-gray-800 transition-colors flex justify-center"
            >
              {loading ? "Procesando..." : "Confirmar y Publicar Pedido"}
            </button>
          </div>
        </div>
      );
    }

// --- Componente de Mapa Interactivo (CORREGIDO) ---
// --- Componente de Mapa Interactivo (CORREGIDO) ---
    // Ahora acepta 'mapId' para evitar choques entre pantallas
    function MapComponent({ onLocationSelect, mapId }) {
      const mapRef = useRef(null); 
      const markerRef = useRef(null); 
      const onSelectRef = useRef(onLocationSelect);

      useEffect(() => {
        onSelectRef.current = onLocationSelect;
      }, [onLocationSelect]);

      useEffect(() => {
        if (mapRef.current) return;

        // Usamos el ID √∫nico que nos pasan
        const containerId = mapId || 'default-map'; 
        
        // Validaci√≥n de seguridad: Si el div no existe a√∫n, no intentamos crear el mapa
        if (!document.getElementById(containerId)) return;

        const ESPOL_COORDS = [-2.1467, -79.9654]; 
        try {
            const map = L.map(containerId).setView(ESPOL_COORDS, 16); 
            mapRef.current = map;

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap',
                maxZoom: 19
            }).addTo(map);

            map.on('click', function(e) {
                const { lat, lng } = e.latlng;
                if (markerRef.current) {
                    markerRef.current.setLatLng([lat, lng]);
                } else {
                    markerRef.current = L.marker([lat, lng]).addTo(map);
                }
                if (onSelectRef.current) {
                    onSelectRef.current(`Ubicaci√≥n: ${lat.toFixed(5)}, ${lng.toFixed(5)}`);
                }
            });
        } catch (err) {
            console.error("Error inicializando mapa:", err);
        }

        return () => {
            if (mapRef.current) {
                mapRef.current.off();
                mapRef.current.remove();
                mapRef.current = null;
            }
        };
      }, [mapId]); // Se reinicia si cambia el ID

      return <div id={mapId || 'default-map'} className="w-full h-full z-0"></div>;
    }
// --- Componente: Impresiones R√°pidas (CONECTADO) ---

    function SendReceiveView({ onGoBack, onNavigateToFastPrints, onNavigateToBuyTake }) {
      const [isModalOpen, setIsModalOpen] = useState(false);
      const [fecha, setFecha] = useState("");
      const [recogida, setRecogida] = useState("");
      const [entrega, setEntrega] = useState("");
      const [hora, setHora] = useState("");
      const [descripcion, setDescripcion] = useState("");
      const [whatsapp, setWhatsapp] = useState("");
      const [activeField, setActiveField] = useState("recogida"); 

      const isFormValid = fecha && recogida && entrega && hora && descripcion && whatsapp;

      const handleMapSelection = (coordTexto) => {
          if (activeField === "recogida") setRecogida(coordTexto);
          else setEntrega(coordTexto);
      };

      const handleSubmitOrder = async () => {
          try {
              if (!localStorage.getItem('accessToken')) { alert("Debes iniciar sesi√≥n."); return; }
              const payload = {
                  num_whats: whatsapp,
                  descripcion: `${descripcion} (De: ${recogida} -> A: ${entrega})`, 
                  punto_origen_id: 1, punto_desitno_id: 1, 
                  horaDeseada: new Date().toISOString(), fechaInicial: new Date().toISOString(),
                  costoEnvio: 3.75, estado: "Publicado"
              };
              await apiCall('/pedido/crear/', 'POST', payload);
              alert("‚úÖ ¬°Pedido creado exitosamente!");
              onGoBack();
          } catch (error) { alert("Error: " + error.message); }
      };

      return (
        <div className="min-h-screen bg-white p-4 sm:p-8 animate-in fade-in duration-300">
          <div className="w-full max-w-6xl mx-auto">
            <div className="flex items-center justify-between mb-6">
              <button onClick={onGoBack} className="p-2 hover:bg-gray-100 rounded-full"><ArrowLeft /></button>
              <div className="flex gap-2">
                <button className="px-5 py-2 bg-black text-white rounded-full font-medium text-sm">Enviar/Recoger</button>
              </div>
              <div className="w-10 h-10"></div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
              <div className="bg-white rounded-2xl shadow-lg p-6 sm:p-8 space-y-4">
                <h2 className="text-3xl font-bold text-gray-800 mb-4">Informaci√≥n</h2>
                <input type="text" placeholder="Fecha" onFocus={(e)=>e.target.type='date'} onBlur={(e)=>e.target.type='text'} className="w-full px-4 py-3 bg-gray-100 rounded-lg outline-none focus:ring-2 focus:ring-black" value={fecha} onChange={(e)=>setFecha(e.target.value)}/>
                
                <div className={`transition-all rounded-lg ${activeField === 'recogida' ? 'ring-2 ring-blue-500' : ''}`}>
                    <input type="text" placeholder="üìç Punto de Recogida (Toca aqu√≠)" className="w-full px-4 py-3 bg-gray-100 rounded-lg outline-none border border-transparent focus:bg-white" value={recogida} onChange={(e)=>setRecogida(e.target.value)} onFocus={() => setActiveField('recogida')} />
                </div>
                <div className={`transition-all rounded-lg ${activeField === 'entrega' ? 'ring-2 ring-green-500' : ''}`}>
                    <input type="text" placeholder="üèÅ Punto de Entrega (Toca aqu√≠)" className="w-full px-4 py-3 bg-gray-100 rounded-lg outline-none border border-transparent focus:bg-white" value={entrega} onChange={(e)=>setEntrega(e.target.value)} onFocus={() => setActiveField('entrega')} />
                </div>

                <input type="text" placeholder="Hora de Entrega" onFocus={(e)=>e.target.type='time'} onBlur={(e)=>e.target.type='text'} className="w-full px-4 py-3 bg-gray-100 rounded-lg outline-none focus:ring-2 focus:ring-black" value={hora} onChange={(e)=>setHora(e.target.value)}/>
                <textarea placeholder="Descripci√≥n" rows="4" className="w-full px-4 py-3 bg-gray-100 rounded-lg outline-none focus:ring-2 focus:ring-black" value={descripcion} onChange={(e)=>setDescripcion(e.target.value)}></textarea>
                <input type="tel" placeholder="Whatsapp" className="w-full px-4 py-3 bg-gray-100 rounded-lg outline-none focus:ring-2 focus:ring-black" value={whatsapp} onChange={(e)=>setWhatsapp(e.target.value)}/>
                <button onClick={() => setIsModalOpen(true)} disabled={!isFormValid} className={`w-full py-3 rounded-lg font-medium text-white mt-2 transition-colors ${isFormValid ? 'bg-black hover:bg-gray-800' : 'bg-gray-300 cursor-not-allowed'}`}>Confirmar</button>
              </div>

              <div className={`bg-white rounded-2xl shadow-lg overflow-hidden relative min-h-[400px] border-4 transition-colors ${activeField === 'recogida' ? 'border-blue-100' : 'border-green-100'}`}>
                 {/* AQU√ç EST√Å LA CLAVE: mapId √öNICO */}
                 <MapComponent onLocationSelect={handleMapSelection} mapId="mapa-envios" />
                 <div className={`absolute bottom-4 right-4 backdrop-blur px-4 py-2 rounded-lg shadow-md text-xs font-bold z-[400] pointer-events-none border transition-colors ${activeField === 'recogida' ? 'bg-blue-50 text-blue-700 border-blue-200' : 'bg-green-50 text-green-700 border-green-200'}`}>
                    {activeField === 'recogida' ? 'üìç Seleccionando: RECOGIDA' : 'üèÅ Seleccionando: ENTREGA'}
                 </div>
              </div>
            </div>
          </div>
          {isModalOpen && <ConfirmacionModal onClose={() => setIsModalOpen(false)} servicio="Enviar/Recoger" desde={recogida} hasta={entrega} hora={hora} onConfirmAction={handleSubmitOrder}/>}
        </div>
      );
    }


// --- Componente: Impresiones R√°pidas (CON MAPA) ---
    function FastPrintsView({ onGoBack, onNavigateToSendReceive, onNavigateToBuyTake }) {
      const [isModalOpen, setIsModalOpen] = useState(false);
      
      // Estados Informaci√≥n
      const [fecha, setFecha] = useState("");
      const [recogida, setRecogida] = useState("");
      const [hora, setHora] = useState("");
      
      // Estados Configuraci√≥n
      const [pages, setPages] = useState("Todas");
      const [copies, setCopies] = useState("1");
      const [color, setColor] = useState("Color");
      const [paperSize, setPaperSize] = useState("A4");
      const [fileName, setFileName] = useState(null);
      const fileInputRef = useRef(null);
      const [openDropdown, setOpenDropdown] = useState(null);
      
      const isInfoValid = fecha && recogida && hora && fileName;

      const handleUploadClick = () => fileInputRef.current.click();
      const handleFileSelect = (e) => { if(e.target.files[0]) setFileName(e.target.files[0].name); };
      
      const handleSubmitPrint = async () => {
          try {
              if (!localStorage.getItem('accessToken')) { alert("Debes iniciar sesi√≥n."); return; }

              const descripcion = `IMPRESI√ìN: ${fileName} (${copies} copias, ${color}, ${paperSize}) - Retirar en: ${recogida}`;
              
              await apiCall('/pedido/crear/', 'POST', {
                  num_whats: "0999999999",
                  descripcion,
                  punto_origen_id: 1, punto_desitno_id: 1,
                  horaDeseada: new Date().toISOString(),
                  fechaInicial: new Date().toISOString(),
                  costoEnvio: 1.50, estado: "Publicado"
              });
              alert("‚úÖ Orden de impresi√≥n enviada.");
              onGoBack();
          } catch (error) { alert("Error: " + error.message); }
      };

      const toggleDropdown = (name) => setOpenDropdown(openDropdown === name ? null : name);
      const handleSelect = (setter) => (val) => { setter(val); setOpenDropdown(null); };

      return (
        <div className="min-h-screen bg-gray-50 p-4 sm:p-8 animate-in fade-in duration-300">
          <div className="w-full max-w-4xl mx-auto">
            <div className="flex items-center justify-between mb-6">
              <button onClick={onGoBack} className="p-2 hover:bg-gray-100 rounded-full"><ArrowLeft /></button>
              <div className="flex gap-2">
                <button onClick={onNavigateToSendReceive} className="px-5 py-2 bg-gray-200 text-gray-800 rounded-full font-medium text-sm hover:bg-gray-300">Enviar/Recoger</button>
                <button className="px-5 py-2 bg-black text-white rounded-full font-medium text-sm">Impresiones r√°pidas</button>
                <button onClick={onNavigateToBuyTake} className="px-5 py-2 bg-gray-200 text-gray-800 rounded-full font-medium text-sm hover:bg-gray-300">Comprar/Llevar</button>
              </div>
              <div className="w-10 h-10"></div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div className="flex flex-col gap-6">
                {/* Formulario */}
                <div className="bg-white rounded-2xl shadow-2xl p-6">
                  <h2 className="text-3xl font-bold text-gray-800 mb-6">Informaci√≥n</h2>
                  <div className="space-y-4">
                    <input type="text" placeholder="Fecha" onFocus={(e)=>e.target.type='date'} onBlur={(e)=>e.target.type='text'} className="w-full px-4 py-3 bg-gray-100 rounded-lg outline-none" value={fecha} onChange={(e)=>setFecha(e.target.value)}/>
                    
                    {/* Input conectado al mapa */}
                    <input type="text" placeholder="üìç Punto de Recogida (Usa el mapa)" className="w-full px-4 py-3 bg-gray-100 rounded-lg outline-none border-2 focus:border-blue-500" value={recogida} onChange={(e)=>setRecogida(e.target.value)}/>
                    
                    <input type="text" placeholder="Hora Deseada" onFocus={(e)=>e.target.type='time'} onBlur={(e)=>e.target.type='text'} className="w-full px-4 py-3 bg-gray-100 rounded-lg outline-none" value={hora} onChange={(e)=>setHora(e.target.value)}/>
                    <button onClick={() => setIsModalOpen(true)} disabled={!isInfoValid} className={`w-full py-3 rounded-lg font-medium text-white transition-colors ${isInfoValid ? 'bg-black hover:bg-gray-800' : 'bg-gray-300'}`}>Confirmar</button>
                  </div>
                </div>

                <div className="bg-white rounded-2xl shadow-2xl p-6">
                  <h3 className="text-xl font-semibold text-gray-800 mb-4">Configuraci√≥n</h3>
                  <div className="space-y-4">
                    <input type="file" ref={fileInputRef} onChange={handleFileSelect} style={{ display: "none" }} accept=".pdf,.doc,.docx" />
                    <button onClick={handleUploadClick} className="w-full bg-gray-100 text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-200 border border-dashed border-gray-300">{fileName ? `üìÑ ${fileName}` : "Subir Archivo"}</button>
                    <div className="relative">
                        <button onClick={()=>toggleDropdown("color")} className="w-full flex justify-between items-center px-4 py-3 bg-gray-100 rounded-lg mt-1"><span>{color}</span><ChevronDown/></button>
                        {openDropdown === "color" && <DropdownMenu options={["Color", "Blanco y Negro"]} onSelect={handleSelect(setColor)}/>}
                    </div>
                    <input type="number" min="1" value={copies} onChange={(e)=>setCopies(e.target.value)} className="w-full px-4 py-3 bg-gray-100 rounded-lg mt-1" placeholder="Copias"/>
                  </div>
                </div>
              </div>

              {/* MAPA REAL */}
              <div className="flex flex-col gap-6 h-full">
                <div className="bg-white rounded-2xl shadow-2xl overflow-hidden relative h-full min-h-[400px] border border-gray-200">
                   <MapComponent onLocationSelect={(text) => setRecogida(text)} />
                   <div className="absolute bottom-4 right-4 bg-white/90 backdrop-blur px-4 py-2 rounded-lg shadow-md text-xs font-bold text-gray-700 z-[400] pointer-events-none border border-gray-100">
                      üìç Toca para seleccionar recogida
                   </div>
                </div>
              </div>
            </div>
          </div>
          {isModalOpen && <ConfirmacionModal onClose={() => setIsModalOpen(false)} servicio="Impresiones R√°pidas" desde={recogida} hasta="Tu mano" hora={hora} onConfirmAction={handleSubmitPrint}/>}
        </div>
      );
    }
// --- Vista Principal: Enviar/Recoger (CONECTADA + MAPA INTELIGENTE) ---

// --- Componente: Comprar/Llevar (CON MAPA INTELIGENTE) ---
    function BuyTakeView({ onGoBack, onNavigateToSendReceive, onNavigateToFastPrints }) {
      // ... (Mismos estados que antes) ...
      const [storeName, setStoreName] = useState("");
      const [storeAddress, setStoreAddress] = useState("");
      const [deliveryPoint, setDeliveryPoint] = useState("");
      const [whatsapp, setWhatsapp] = useState("");
      const [activeField, setActiveField] = useState("store"); 
      const [items, setItems] = useState([]); 
      const [nextId, setNextId] = useState(1);
      const [isModalOpen, setIsModalOpen] = useState(false);
      const isInfoValid = storeName && storeAddress && deliveryPoint && whatsapp;
      const areItemsValid = items.length > 0 && items.every(i => i.description && i.quantity > 0);

      const handleMapSelection = (coordTexto) => {
          if (activeField === "store") setStoreAddress(coordTexto);
          else setDeliveryPoint(coordTexto);
      };
      const handleAddItem = () => { setItems([...items, { id: nextId, description: '', quantity: 1, cost: '' }]); setNextId(nextId + 1); };
      const handleDeleteItem = (id) => setItems(items.filter(i => i.id !== id));
      const handleItemChange = (id, field, value) => { setItems(curr => curr.map(i => i.id === id ? { ...i, [field]: value } : i)); };
      const handleSubmitBuy = async () => {
          try {
              if (!localStorage.getItem('accessToken')) { alert("Inicia sesi√≥n primero."); return; }
              const listaTexto = items.map(i => `- ${i.quantity}x ${i.description} (Est: $${i.cost || '?'})`).join('\n');
              const descripcion = `COMPRAR: ${storeName} (${storeAddress}) -> Entregar: ${deliveryPoint}\nLISTA:\n${listaTexto}`;
              await apiCall('/pedido/crear/', 'POST', {
                  num_whats: whatsapp, descripcion, punto_origen_id: 1, punto_desitno_id: 1,
                  horaDeseada: new Date().toISOString(), fechaInicial: new Date().toISOString(),
                  costoEnvio: 2.50, estado: "Publicado"
              });
              alert("‚úÖ Pedido de compra creado."); onGoBack();
          } catch (e) { alert("Error: " + e.message); }
      };

      return (
        <div className="min-h-screen bg-white p-4 sm:p-8 animate-in fade-in duration-300">
          <div className="w-full max-w-4xl mx-auto">
            <div className="flex items-center justify-between mb-6">
              <button onClick={onGoBack} className="p-2 hover:bg-gray-100 rounded-full"><ArrowLeft /></button>
              <div className="flex gap-2">
                <button onClick={onNavigateToSendReceive} className="px-5 py-2 bg-gray-200 text-gray-800 rounded-full font-medium text-sm hover:bg-gray-300">Enviar/Recoger</button>
                <button onClick={onNavigateToFastPrints} className="px-5 py-2 bg-gray-200 text-gray-800 rounded-full font-medium text-sm hover:bg-gray-300">Impresiones r√°pidas</button>
                <button className="px-5 py-2 bg-black text-white rounded-full font-medium text-sm">Comprar/Llevar</button>
              </div>
              <div className="w-10 h-10"></div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
              <div className="bg-white rounded-2xl shadow-lg p-6 space-y-4 h-full">
                <h2 className="text-3xl font-bold text-gray-800 mb-4">Informaci√≥n</h2>
                <input type="text" placeholder="Nombre de la Tienda" className="w-full px-4 py-3 bg-gray-100 rounded-lg outline-none" value={storeName} onChange={e=>setStoreName(e.target.value)}/>
                <div className={`transition-all rounded-lg ${activeField === 'store' ? 'ring-2 ring-blue-500' : ''}`}>
                    <input type="text" placeholder="üìç Direcci√≥n Tienda (Toca para mapa)" className="w-full px-4 py-3 bg-gray-100 rounded-lg outline-none border border-transparent focus:bg-white" value={storeAddress} onChange={e=>setStoreAddress(e.target.value)} onFocus={() => setActiveField('store')} />
                </div>
                <div className={`transition-all rounded-lg ${activeField === 'delivery' ? 'ring-2 ring-green-500' : ''}`}>
                    <input type="text" placeholder="üèÅ Punto de Entrega (Toca para mapa)" className="w-full px-4 py-3 bg-gray-100 rounded-lg outline-none border border-transparent focus:bg-white" value={deliveryPoint} onChange={e=>setDeliveryPoint(e.target.value)} onFocus={() => setActiveField('delivery')} />
                </div>
                <input type="tel" placeholder="Tu Whatsapp" className="w-full px-4 py-3 bg-gray-100 rounded-lg outline-none" value={whatsapp} onChange={e=>setWhatsapp(e.target.value)}/>
              </div>

              <div className={`bg-white rounded-2xl shadow-lg overflow-hidden relative min-h-[400px] border-4 transition-colors ${activeField === 'store' ? 'border-blue-100' : 'border-green-100'}`}>
                 {/* AQU√ç EST√Å LA CLAVE: mapId √öNICO */}
                 <MapComponent onLocationSelect={handleMapSelection} mapId="mapa-compras" />
                 <div className={`absolute bottom-4 right-4 backdrop-blur px-4 py-2 rounded-lg shadow-md text-xs font-bold z-[400] pointer-events-none border transition-colors ${activeField === 'store' ? 'bg-blue-50 text-blue-700 border-blue-200' : 'bg-green-50 text-green-700 border-green-200'}`}>
                    {activeField === 'store' ? 'üìç Seleccionando: TIENDA' : 'üèÅ Seleccionando: ENTREGA'}
                 </div>
              </div>
            </div>

            <div className="bg-white rounded-2xl shadow-lg p-6 space-y-4">
              <h2 className="text-3xl font-bold text-gray-800 mb-4">Lista de Compras</h2>
              {items.map(item => (
                  <div key={item.id} className="flex gap-2 items-center">
                      <input className="w-full p-3 bg-gray-100 rounded" placeholder="Producto" value={item.description} onChange={e=>handleItemChange(item.id, 'description', e.target.value)}/>
                      <input type="number" className="w-20 p-3 bg-gray-100 rounded text-center" placeholder="#" value={item.quantity} onChange={e=>handleItemChange(item.id, 'quantity', e.target.value)}/>
                      <input type="number" className="w-24 p-3 bg-gray-100 rounded text-center" placeholder="$ Est." value={item.cost} onChange={e=>handleItemChange(item.id, 'cost', e.target.value)}/>
                      <button onClick={()=>handleDeleteItem(item.id)} className="p-2 text-red-500"><Trash/></button>
                  </div>
              ))}
              <button onClick={handleAddItem} className="flex items-center gap-2 px-4 py-2 border-2 border-dashed rounded text-gray-600 hover:bg-gray-50"><Plus className="w-4 h-4"/> A√±adir Producto</button>
            </div>

            <div className="mt-8 flex justify-end">
              <button onClick={() => setIsModalOpen(true)} disabled={!isInfoValid || !areItemsValid} className={`px-8 py-3 rounded-lg font-medium text-white ${isInfoValid && areItemsValid ? 'bg-black hover:bg-gray-800' : 'bg-gray-300 cursor-not-allowed'}`}>Confirmar y Pagar</button>
            </div>
          </div>
          {isModalOpen && <ConfirmacionModal onClose={() => setIsModalOpen(false)} servicio="Comprar/Llevar" desde={storeName} hasta={deliveryPoint} hora="N/A" onConfirmAction={handleSubmitBuy}/>}
        </div>
      );
    }

    function NewFavorView({ onGoBack, onNavigateToSendReceive, onNavigateToFastPrints, onNavigateToBuyTake }) {
      
      return (
        <div className="min-h-screen bg-gray-50 p-4 sm:p-8 animate-in fade-in duration-300">
          <div className="bg-white rounded-2xl shadow-2xl w-full max-w-xl mx-auto">
            <div className="flex items-center p-6 pb-4">
              <button
                onClick={onGoBack}
                className="p-2 hover:bg-gray-100 rounded-full transition-colors mr-4"
              >
                <ArrowLeft />
              </button>
              <h2 className="text-4xl font-bold text-gray-800">
                Programa tu Mandado
              </h2>
            </div>
            <div className="px-6 pb-6">
              
              {/* --- Categor√≠as (Mantenidas) --- */}
              <div className="mt-4">
                <h3 className="text-xl font-bold text-gray-800 mb-4">
                  Categor√≠a de Servicios
                </h3>
                <div className="flex flex-col gap-4">
                  
                  {/* Impresiones */}
                  <div 
                    onClick={onNavigateToFastPrints}
                    className="bg-gray-100 p-4 rounded-lg cursor-pointer hover:bg-gray-200 transition-colors"
                  >
                    <div className="flex justify-between items-center">
                      <h4 className="font-bold text-sm">IMPRESIONES R√ÅPIDAS</h4>
                      <ChevronUp />
                    </div>
                    <p className="text-sm text-gray-600 mt-2">
                      Sube archivos digitales y recoge el pedido listo en el punto designado.
                    </p>
                  </div>
                  
                  {/* Enviar/Recoger */}
                  <div
                    onClick={onNavigateToSendReceive}
                    className="bg-gray-100 p-4 rounded-lg cursor-pointer hover:bg-gray-200 transition-colors"
                  >
                    <h4 className="font-bold text-sm">ENVIAR/RECOGER</h4>
                    <p className="text-sm text-gray-600 mt-2">
                      Servicio de mensajer√≠a interna r√°pido para trasladar objetos entre dos puntos del campus.
                    </p>
                  </div>
                  
                  {/* Comprar/LLevar */}
                  <div
                    onClick={onNavigateToBuyTake}
                    className="bg-gray-100 p-4 rounded-lg cursor-pointer hover:bg-gray-200 transition-colors"
                  >
                    <h4 className="font-bold text-sm">COMPRAR/LLEVAR</h4>
                    <p className="text-sm text-gray-600 mt-2">
                      Pide art√≠culos de tiendas fuera del campus y rec√≠belos sin salir.
                    </p>
                  </div>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // --- Componente: Nueva Vista de Registro de Repartidor ---
    function DriverRegisterView({ onGoBack, onNavigateToWelcome, onSignIn, onRegister }) {
      return (
        <div className="min-h-screen bg-gray-50">
          {/* Header simple para navegacion */}
          <header className="bg-white shadow-sm sticky top-0 z-50 border-b border-gray-200">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <div className="flex items-center justify-between h-16">
                <button
                  onClick={onGoBack}
                  className="p-2 hover:bg-gray-100 rounded-full transition-colors"
                >
                  <ArrowLeft />
                </button>
                <div className="flex items-center gap-3">
                  <button onClick={onSignIn} className="px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">Sign in</button>
                  <button onClick={onRegister} className="px-4 py-2 text-sm font-medium text-white bg-black hover:bg-gray-800 rounded-lg transition-colors">Register</button>
                  <div className="w-px h-8 bg-gray-300 mx-2" />
                  <button className="p-2 hover:bg-gray-100 rounded-lg transition-colors relative"><ShoppingCart /></button>
                </div>
              </div>
            </div>
          </header>

          <main className="max-w-7xl mx-auto py-0">
            {/* Secci√≥n Banner Superior */}
            <div className="bg-black text-white p-8 md:p-16 rounded-b-2xl shadow-xl overflow-hidden relative">
              
              <div className="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                {/* Contenido Izquierdo */}
                <div className="relative z-10 space-y-4 max-w-lg">
                  <h1 className="text-4xl md:text-5xl font-bold leading-tight">
                    Haz entregas en tu universidad.
                  </h1>
                  <p className="text-gray-300 text-lg">
                    Reg√≠strate en nuestra plataforma y empieza a hacer env√≠os en tu universidad. Disfruta de la libertad de trabajar solo cuando lo decidas, ayudando a tus compa√±eros mientras ganas un extra.
                  </p>
                  <button onClick={onNavigateToWelcome} className="px-6 py-3 bg-white text-black rounded-lg font-semibold hover:bg-gray-200 transition-colors shadow-lg mt-6">
                    Reg√≠strate para hacer entregas
                  </button>
                </div>

                {/* Ilustraci√≥n Derecha (Mockup basado en la imagen, usando SVG) */}
                <div className="hidden md:block absolute right-0 top-0 h-full w-1/2 p-8 pt-16 lg:p-16">
                   <div className="absolute inset-0">
                        {/* Delivery Person SVG (Simplified inline) */}
                        <svg viewBox="0 0 100 100" className="w-full h-full" preserveAspectRatio="xMidYMid meet">
                            {/* Head/Hat */}
                            <rect x="62" y="10" width="18" height="3" fill="#B30000" rx="1.5"/>
                            <rect x="65" y="13" width="12" height="5" fill="#B30000" rx="1"/>
                            <circle cx="71" cy="22" r="5" fill="#F0C088" />
                            {/* Torso/Arms */}
                            <path d="M68 30 L64 50 L68 50 L72 30 Z" fill="#FFFFFF" stroke="#000000" strokeWidth="1"/>
                            <path d="M74 30 L78 50 L74 50 L70 30 Z" fill="#FFFFFF" stroke="#000000" strokeWidth="1"/>
                            {/* Legs */}
                            <path d="M65 55 L63 80 L67 80 L69 55 Z" fill="#6A6A6A"/>
                            <path d="M77 55 L75 80 L79 80 L81 55 Z" fill="#6A6A6A"/>
                            {/* Box */}
                            <rect x="58" y="38" width="26" height="20" fill="#E48E44" stroke="#000000" strokeWidth="1"/>
                            <line x1="58" y1="48" x2="84" y2="48" stroke="#000000" strokeWidth="1"/>
                            <line x1="71" y1="38" x2="71" y2="58" stroke="#000000" strokeWidth="1"/>
                        </svg>
                </div>
                </div>
              </div>
            </div>

            {/* Contenido Inferior */}
            <div className="px-4 sm:px-6 lg:px-8 py-12 md:py-16">
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                {/* Columna 1: Requisitos */}
                <div>
                  <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                     <Walk className="w-6 h-6 text-black" />
                     Descubre lo que necesitas para empezar a trabajar.
                  </h3>
                  <ul className="text-gray-600 space-y-2">
                    <li className="flex items-center gap-2">
                       <Check className="w-4 h-4 text-green-500" /> C√©dula de identidad o carnet estudiantil.
                    </li>
                    <li className="flex items-center gap-2">
                       <Check className="w-4 h-4 text-green-500" /> Tiempo libre
                    </li>
                  </ul>
                </div>

                {/* Columna 2: Pasos */}
                <div className="md:col-span-1">
                  <h3 className="text-xl font-bold text-gray-800 mb-4">
                    En 3 simples pasos
                  </h3>
                  <ol className="text-gray-600 space-y-2 list-none p-0">
                    <li className="font-semibold text-black">1. Reg√≠strate</li>
                    <li>2. Recoge y entrega</li>
                    <li>3. Gana dinero</li>
                  </ol>
                </div>
                
              </div>
            </div>
          </main>
        </div>
      );
    }
    // --- FIN Componente: Nueva Vista de Registro de Repartidor ---

    // --- Componente: Nueva Vista "Bienvenida Repartidor" ---
    function DriverWelcomeView({ onGoBack, onNavigateToProfilePhoto, onNavigateToCarnetPhoto }) { // ** CAMBIO: Nueva prop para navegar al carnet **
      return (
        <div className="min-h-screen bg-white p-4 sm:p-8 animate-in fade-in duration-300">
          <header className="max-w-4xl mx-auto mb-12">
             <div className="flex items-center justify-between h-16">
               <button
                 onClick={onGoBack}
                 className="p-2 hover:bg-gray-100 rounded-full transition-colors"
               >
                 <ArrowLeft />
               </button>
               {/* La imagen original ten√≠a un √≠cono de Men√∫, pero 'Atr√°s' es m√°s l√≥gico para el flujo */}
             </div>
          </header>
          
          <main className="max-w-4xl mx-auto">
            <h1 className="text-5xl sm:text-6xl font-bold text-gray-900 mb-16">
              Te damos la bienvenida.
            </h1>
            
            <div className="space-y-4">
              {/* Borde sutil de color p√∫rpura como en la imagen */}
              <button 
                onClick={onNavigateToProfilePhoto}
                className="w-full flex justify-between items-center p-6 border-b border-purple-200 hover:bg-purple-50 transition-colors group"
              >
                <span className="text-lg font-medium text-gray-800">
                  Foto de perfil.
                </span>
                <ChevronRight />
              </button>
              
              <button 
                onClick={onNavigateToCarnetPhoto} // ** CAMBIO: Nuevo handler para navegar **
                className="w-full flex justify-between items-center p-6 border-b border-purple-200 hover:bg-purple-50 transition-colors group"
              >
                <span className="text-lg font-medium text-gray-800">
                  Foto del carnet estudiantil.
                </span>
                <ChevronRight />
              </button>
            </div>
          </main>
        </div>
      );
    }
    // --- FIN Componente: Nueva Vista "Bienvenida Repartidor" ---
    
    // --- Componente: NUEVA Vista "Subir Foto de Carnet" ---
    function CarnetPhotoUploadView({ onGoBack }) {
      const fileInputRef = useRef(null);
      const [fileName, setFileName] = useState(null);
      
      const handleUploadClick = () => fileInputRef.current.click();
      const handleFileSelect = (event) => {
        const file = event.target.files[0];
        if (file) setFileName(file.name);
      };

      return (
        // Fondo rosa p√°lido como en la imagen
        <div className="min-h-screen bg-pink-50 p-4 sm:p-8 animate-in fade-in duration-300">
          {/* Header - Bot√≥n de Ayuda */}
          <header className="max-w-xl mx-auto mb-8 flex justify-between items-center">
             {/* Bot√≥n para volver */}
             <button
                onClick={onGoBack}
                className="p-2 hover:bg-gray-100 rounded-full transition-colors"
              >
                <ArrowLeft />
              </button>
             
             <button className="flex items-center gap-2 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-black transition-colors">
               <HelpCircle />
               <span className="text-sm font-medium">Ayuda</span>
             </button>
          </header>
          
          <main className="max-w-xl mx-auto">
            <h1 className="text-4xl sm:text-5xl font-bold text-gray-900 mb-6">
              Tomate una foto al carnet estudiantil.
            </h1>
            
            <p className="text-gray-700 mb-6">
              Toma una foto de tu carn√© estudiantil de la ESPOL. Aseg√∫rate de que la foto contenga toda la informaci√≥n que aparece en el frente (nombre, foto, c√≥digo/matr√≠cula).
            </p>
            
            <p className="text-gray-700 font-semibold mb-8">
              Recuerda que los requisitos son los siguientes:
              <ul className="list-disc list-inside ml-4 mt-2 font-normal">
                <li>El carn√© debe estar vigente.</li>
                <li>Solo se aceptan carn√©s de la ESPOL (Escuela Superior Polit√©cnica del Litoral).</li>
              </ul>
            </p>
            
            {/* Placeholder de Carnet */}
            <div className="w-full flex justify-center mb-8">
              <div className="w-full max-w-sm h-48 bg-gray-300 rounded-xl flex items-center justify-center border-4 border-dashed border-gray-400">
                <IdCard className="w-40 h-40 text-gray-500" />
              </div>
            </div>
            
            {/* Campo de archivo y Bot√≥n de Acci√≥n */}
            <div className="space-y-4">
              <input 
                type="file" 
                ref={fileInputRef} 
                onChange={handleFileSelect} 
                style={{ display: "none" }} 
                accept="image/*" 
              />
              <button 
                onClick={handleUploadClick}
                className="w-full bg-gray-800 text-white py-4 rounded-lg font-medium hover:bg-black transition-colors"
              >
                {fileName ? `Cargar foto: ${fileName}` : "Cargar foto"}
              </button>
            </div>

          </main>
        </div>
      );
    }
    // --- FIN Componente: NUEVA Vista "Subir Foto de Carnet" ---

    // --- Componente: Nueva Vista "Subir Foto de Perfil" ---
    function ProfilePhotoUploadView({ onGoBack }) {
      // --- Estado para la c√°mara ---
      const [stream, setStream] = useState(null); // Almacena el stream de video
      const [error, setError] = useState(null); // Almacena mensajes de error
      const videoRef = useRef(null); // Referencia al elemento <video>

      // --- Funci√≥n para iniciar la c√°mara ---
      const handleStartCamera = async () => {
        setError(null); // Limpiar errores previos
        try {
          // Solicitar acceso al video
          const s = await navigator.mediaDevices.getUserMedia({ 
            video: true,
            audio: false 
          });
          setStream(s); // Guardar el stream en el estado
        } catch (err) {
          console.error("Error accessing camera: ", err);
          setError("No se pudo acceder a la c√°mara. Aseg√∫rate de dar permiso.");
        }
      };

      // --- Efecto para manejar el stream ---
      useEffect(() => {
        // Asignar el stream al <video> cuando ambos existan
        if (stream && videoRef.current) {
          videoRef.current.srcObject = stream;
        }
        
        // Funci√≥n de limpieza:
        // Se ejecuta cuando el componente se desmonta o 'stream' cambia
        return () => {
          if (stream) {
            // Detener todas las pistas (apagar la c√°mara)
            stream.getTracks().forEach(track => track.stop());
          }
        };
      }, [stream]); // Este efecto depende del estado 'stream'

      return (
        // Fondo rosa p√°lido como en la imagen
        <div className="min-h-screen bg-pink-50 p-4 sm:p-8 animate-in fade-in duration-300">
          {/* Header - Bot√≥n de Ayuda */}
          <header className="max-w-xl mx-auto mb-8 flex justify-between items-center">
             {/* Bot√≥n para volver */}
             <button
                onClick={onGoBack}
                className="p-2 hover:bg-gray-100 rounded-full transition-colors"
              >
                <ArrowLeft />
              </button>
             
             <button className="flex items-center gap-2 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-black transition-colors">
               <HelpCircle />
               <span className="text-sm font-medium">Ayuda</span>
             </button>
          </header>
          
          <main className="max-w-xl mx-auto">
            <h1 className="text-4xl sm:text-5xl font-bold text-gray-900 mb-6">
              Tomate una foto de perfil.
            </h1>
            
            <p className="text-gray-700 mb-6">
              Por motivos de seguridad, solo aceptamos fotograf√≠as que hayan sido tomadas directamente con la c√°mara en el momento del env√≠o.
            </p>
            
            <ol className="list-decimal list-inside text-gray-700 space-y-2 mb-8">
              <li>Mira a la c√°mara directamente y verifica que los ojos y la boca se vean con claridad.</li>
              <li>Aseg√∫rate de que la foto est√© enfocada, bien iluminada y sin reflejos de luz.</li>
              <li>No se permiten fotos de una foto, filtros ni modificaciones.</li>
            </ol>
            
            {/* Placeholder de Foto (AHORA DIN√ÅMICO) */}
            <div className="w-full flex justify-center mb-8">
              {/* Contenedor circular con overflow hidden */}
              <div className="w-56 h-56 bg-gray-300 rounded-full flex items-center justify-center overflow-hidden">
                {stream ? (
                  // Si el stream existe, muestra el video
                  <video 
                    ref={videoRef} 
                    autoPlay 
                    playsInline 
                    muted // Silenciado para evitar loops de audio
                    className="w-full h-full object-cover transform -scale-x-100" // -scale-x-100 para efecto espejo
                  />
                ) : (
                  // Si no, muestra el √≠cono de usuario
                  <User className="w-32 h-32 text-gray-500" />
                )}
              </div>
            </div>
            
            {/* Mensaje de Error (si existe) */}
            {error && (
              <div className="text-center text-red-600 font-medium mb-4">
                {error}
              </div>
            )}

            {/* Botones de Acci√≥n (AHORA DIN√ÅMICOS) */}
            <div className="space-y-4">
              {stream ? (
                // Si la c√°mara est√° activa, muestra "Capturar foto"
                <button className="w-full bg-gray-800 text-white py-4 rounded-lg font-medium hover:bg-black transition-colors">
                  Capturar foto
                </button>
              ) : (
                // Si no, muestra "Tomar foto"
                <button 
                  onClick={handleStartCamera}
                  className="w-full bg-gray-800 text-white py-4 rounded-lg font-medium hover:bg-black transition-colors"
                >
                  Tomar foto
                </button>
              )}
            </div>

          </main>
        </div>
      );
    }
    // --- FIN Componente: Nueva Vista "Subir Foto de Perfil" ---


    // --- Componente: P√°gina Principal ---
    function HomePage() {
      const [menuOpen, setMenuOpen] = useState(false);
      const [showAuthModal, setShowAuthModal] = useState(false);
      const [authMode, setAuthMode] = useState("signin");
      const [isLoggedIn, setIsLoggedIn] = useState(false);
      const [currentUser, setCurrentUser] = useState(null);

// Estados Form Auth (NUEVOS)
      const [email, setEmail] = useState("");
      const [pass, setPass] = useState("");
      const [nombre, setNombre] = useState("");
      const [apellido, setApellido] = useState("");

      // Verificar sesi√≥n al cargar la p√°gina
      useEffect(() => {
          const token = localStorage.getItem('accessToken');
          if (token) {
              apiCall('/usuario/me/').then(u => {
                  setIsLoggedIn(true);
                  setCurrentUser(u);
              }).catch(() => {
                  setIsLoggedIn(false);
                  localStorage.removeItem('accessToken');
              });
          }
      }, []);

      // Funci√≥n para manejar Login y Registro
// --- Funci√≥n Conectada Correctamente ---
      const handleAuth = async () => {
          console.log("Intentando autenticaci√≥n..."); // Para ver en consola si el clic funciona
          
          try {
              if (authMode === "signin") {
                  // LOGIN
                  console.log("Enviando Login...", { email, pass });
                  const data = await apiCall('/login/', 'POST', { 
                      email: email, 
                      password: pass  // Enviamos 'pass' como 'password' al backend
                  });
                  
                  localStorage.setItem('accessToken', data.access);
                  
                  // Obtener datos del usuario
                  const me = await apiCall('/usuario/me/');
                  setCurrentUser(me);
                  setIsLoggedIn(true);
                  setShowAuthModal(false);
                  alert(`¬°Hola de nuevo, ${me.nombre}!`);
                  
              } else {
                  // REGISTRO
                  console.log("Enviando Registro...", { email, nombre, apellido, pass });
                  
                  // Validaci√≥n r√°pida antes de enviar
                  if (!nombre || !apellido || !email || !pass) {
                      alert("Por favor completa todos los campos.");
                      return;
                  }

                  await apiCall('/usuario/crear/', 'POST', { 
                      correo: email, 
                      contrasena: pass, // Usamos tu variable 'pass'
                      nombre: nombre,   // Usamos tu variable 'nombre'
                      apellido: apellido, // Usamos tu variable 'apellido'
                      rol: 'estudiante' 
                  });
                  
                  alert("‚úÖ ¬°Cuenta creada con √©xito! Ahora inicia sesi√≥n.");
                  setAuthMode("signin"); // Cambiar el formulario a Login
              }
          } catch (e) { 
              console.error("Error Auth:", e);
              alert("‚ùå Error: " + e.message); 
          }
      };
      
      const handleLogout = () => {
        localStorage.removeItem('accessToken');
        setIsLoggedIn(false);
        setCurrentUser(null);
        setMenuOpen(false); // Cerrar men√∫ si est√° abierto
      };      
      // ***** CAMBIO: A√±adido 'driverWelcome', 'profilePhotoUpload' y 'carnetPhotoUpload' *****
      const [currentView, setCurrentView] =useState("home"); // 'home', 'newFavor', 'sendReceive', 'fastPrints', 'help', 'buyTake', 'driverRegister', 'driverWelcome', 'profilePhotoUpload', 'carnetPhotoUpload'

      const faqData = [
        { q: "¬øC√≥mo hago un pedido de un favor?", a: "Simplemente navega por las categor√≠as, selecciona el favor que necesitas, y completa los detalles de recogida y entrega." },
        { q: "¬øC√≥mo s√© d√≥nde est√° mi pedido?", a: "Puedes seguir el progreso de tu favor en tiempo real desde la secci√≥n \"Historial de Pedidos\" y ver la ubicaci√≥n del repartidor en el mapa." },
        { q: "¬øQu√© m√©todos de pago aceptan?", a: "Solo pago en efectivo." },
        { q: "¬øPuedo cancelar un favor?", a: "S√≠, puedes cancelar un favor desde la secci√≥n \"Historial de Pedidos\" siempre y cuando el repartidor a√∫n no haya confirmado la recogida." },
        { isSeparator: true },
        { q: "¬øC√≥mo me registro para hacer entregas?", a: "Haz clic en \"Reg√≠strate para hacer entregas\" en la p√°gina principal, completa tus datos (carnet estudiantil) y sube tu foto de perfil." },
        { q: "¬øQu√© necesito para ser repartidor?", a: "Solo necesitas tu carnet estudiantil vigente y tiempo libre para aceptar favores." },
        { q: "¬øC√≥mo acepto un favor?", a: "Cuando haya un favor disponible cerca, aparecer√° una notificaci√≥n. Haz clic en \"Aceptar\" y se te mostrar√° el mapa con las direcciones de recogida y entrega." },
        { q: "¬øCu√°ndo recibo mi pago?", a: "Recibes el pago del favor en efectivo directamente del cliente al momento de completar la entrega." }
      ];

      const renderHelpView = () => {
        return (
          <div className="min-h-screen bg-white">
            <header className="bg-white shadow-sm sticky top-0 z-50 border-b border-gray-200">
              <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div className="flex items-center justify-between h-16">
                  <button onClick={() => setMenuOpen(!menuOpen)} className="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                    <Menu />
                  </button>
                  <div className="flex items-center gap-3">
                    {isLoggedIn ? (
                      <button className="p-2 hover:bg-gray-100 rounded-lg transition-colors"><User /></button>
                    ) : (
                      <>
                        <button onClick={() => { setAuthMode("signin"); setShowAuthModal(true); }} className="px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">Sign in</button>
                        <button onClick={() => { setAuthMode("register"); setShowAuthModal(true); }} className="px-4 py-2 text-sm font-medium text-white bg-black hover:bg-gray-800 rounded-lg transition-colors">Register</button>
                      </>
                    )}
                    <div className="w-px h-8 bg-gray-300 mx-2" />
                    <button className="p-2 hover:bg-gray-100 rounded-lg transition-colors relative"><ShoppingCart /></button>
                  </div>
                </div>
              </div>
              {showAuthModal && (
                <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 animate-in fade-in duration-200">
                  <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm animate-in zoom-in-95 duration-200">
                    <div className="flex items-center justify-between p-6 pb-4">
                      <h2 className="text-xl font-semibold text-gray-800">{authMode === "signin" ? "Iniciar sesi√≥n" : "Registrarse"}</h2>
                      <button onClick={() => setShowAuthModal(false)} className="p-2 hover:bg-gray-100 rounded-full transition-colors"><X /></button>
                    </div>
                    <div className="px-6 pb-6">
                      <div className="space-y-4">
                        
                        {/* --- CAMPOS DIN√ÅMICOS --- */}
                        {authMode === "register" && (
                            <>
                            <div>
                              <label className="block text-sm font-medium text-gray-700 mb-2">Nombre</label>
                              <input 
                                type="text" 
                                placeholder="Tu Nombre" 
                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black outline-none transition-all" 
                                value={nombre} 
                                onChange={e => setNombre(e.target.value)} 
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium text-gray-700 mb-2">Apellido</label>
                              <input 
                                type="text" 
                                placeholder="Tu Apellido" 
                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black outline-none transition-all" 
                                value={apellido} 
                                onChange={e => setApellido(e.target.value)} 
                              />
                            </div>
                            </>
                        )}

                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Email</label>
                          <input 
                            type="email" 
                            placeholder="nombre@ejemplo.com" 
                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black outline-none transition-all" 
                            value={email} 
                            onChange={e => setEmail(e.target.value)} 
                          />
                        </div>

                        <div>
                          <label className="block text-sm font-medium text-gray-700 mb-2">Contrase√±a</label>
                          <input 
                            type="password" 
                            placeholder="********" 
                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black outline-none transition-all" 
                            value={pass} 
                            onChange={e => setPass(e.target.value)} 
                          />
                        </div>
                        
                        {/* --- BOT√ìN CONECTADO --- */}
                        <button 
                            onClick={handleAuth} 
                            className="w-full bg-black text-white py-3 rounded-lg font-medium hover:bg-gray-800 transition-colors mt-6"
                        >
                          {authMode === "signin" ? "Iniciar sesi√≥n" : "Registrarse"}
                        </button>
                        
                        {/* --- SWITCH LOGIN/REGISTRO --- */}
                        <div className="text-center mt-6 pt-6 border-t border-gray-200">
                          <p className="text-sm text-gray-600">
                            {authMode === "signin" ? "¬øNo tienes cuenta?" : "¬øYa tienes cuenta?"}{" "}
                            <button 
                                onClick={() => setAuthMode(authMode === "signin" ? "register" : "signin")} 
                                className="text-black font-medium hover:underline"
                            >
                              {authMode === "signin" ? "Reg√≠strate" : "Inicia sesi√≥n"}
                            </button>
                          </p>
                        </div>

                      </div>
                    </div>
                  </div>
                </div>
              )}
              {menuOpen && (
                <div className="absolute top-16 left-0 w-64 bg-white shadow-lg border-t animate-in slide-in-from-left z-50">
                  <nav className="py-2">
                    <a href="#" onClick={(e) => { e.preventDefault(); setCurrentView("home"); setMenuOpen(false); }} className="block px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors">Inicio</a>
                    <a href="#" className="block px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors">Mis pedidos</a>
                    <a href="#" onClick={(e) => { e.preventDefault(); setCurrentView("driverRegister"); setMenuOpen(false); }} className="block px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors">Ser repartidor</a>
                    <a href="#" onClick={(e) => { e.preventDefault(); setCurrentView("help"); setMenuOpen(false); }} className="block px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors">Ayuda</a>
                  </nav>
                </div>
              )}
            </header>
            <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-x-16 gap-y-8">
                {faqData.map((item, index) => {
                  if (item.isSeparator) {
                    return (<div key={index} className="md:col-span-2 border-t border-gray-200 my-4"></div>);
                  }
                  return (
                    <React.Fragment key={index}>
                      <div className="flex flex-col justify-center">
                        <h3 className="text-lg font-semibold text-gray-800 py-4 border-b border-gray-200">{item.q}</h3>
                      </div>
                      <div className="flex flex-col justify-center">
                        <p className="text-gray-600 py-4 border-b border-gray-200">{item.a}</p>
                      </div>
                    </React.Fragment>
                  );
                })}
              </div>
            </main>
          </div>
        );
      };

      // --- L√≥gica de Navegaci√≥n ---
      if (currentView === "newFavor") {
        return <NewFavorView 
          onGoBack={() => setCurrentView("home")} 
          onNavigateToSendReceive={() => setCurrentView("sendReceive")}
          onNavigateToFastPrints={() => setCurrentView("fastPrints")}
          onNavigateToBuyTake={() => setCurrentView("buyTake")}
        />;
      }
      if (currentView === "sendReceive") {
        return <SendReceiveView 
          onGoBack={() => setCurrentView("newFavor")}
          onNavigateToFastPrints={() => setCurrentView("fastPrints")}
          onNavigateToBuyTake={() => setCurrentView("buyTake")}
        />;
      }
      if (currentView === "fastPrints") {
        return <FastPrintsView 
          onGoBack={() => setCurrentView("newFavor")}
          onNavigateToSendReceive={() => setCurrentView("sendReceive")}
          onNavigateToBuyTake={() => setCurrentView("buyTake")}
        />;
      }
      if (currentView === "buyTake") {
        return <BuyTakeView 
          onGoBack={() => setCurrentView("newFavor")}
          onNavigateToSendReceive={() => setCurrentView("sendReceive")}
          onNavigateToFastPrints={() => setCurrentView("fastPrints")}
        />;
      }
      if (currentView === "driverRegister") { // ***** NUEVA VISTA *****
        return <DriverRegisterView 
          onGoBack={() => setCurrentView("home")} 
          onNavigateToWelcome={() => setCurrentView("driverWelcome")}
          onSignIn={() => { setAuthMode("signin"); setShowAuthModal(true); }}
          onRegister={() => { setAuthMode("register"); setShowAuthModal(true); }}
        />;
      }
      // --- VISTA NUEVA: DriverWelcomeView ---
      if (currentView === "driverWelcome") {
        return <DriverWelcomeView 
          onGoBack={() => setCurrentView("driverRegister")} 
          onNavigateToProfilePhoto={() => setCurrentView("profilePhotoUpload")}
          onNavigateToCarnetPhoto={() => setCurrentView("carnetPhotoUpload")} // ** CAMBIO: Nueva navegaci√≥n **
        />;
      }
      // --- VISTA NUEVA: ProfilePhotoUploadView ---
      if (currentView === "profilePhotoUpload") {
        return <ProfilePhotoUploadView 
          onGoBack={() => setCurrentView("driverWelcome")} 
        />;
      }
      // --- VISTA NUEVA: CarnetPhotoUploadView ---
      if (currentView === "carnetPhotoUpload") {
        return <CarnetPhotoUploadView 
          onGoBack={() => setCurrentView("driverWelcome")} 
        />;
      }
      if (currentView === "help") {
        return renderHelpView();
      }

      // --- Vista "home" (P√°gina Principal) ---
      return (
        <div className="min-h-screen bg-gray-50">
          <header className="bg-white shadow-sm sticky top-0 z-50">
            <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
              <div className="flex items-center justify-between h-16">
                <button onClick={() => setMenuOpen(!menuOpen)} className="p-2 hover:bg-gray-100 rounded-lg transition-colors"><Menu /></button>
                <div className="flex items-center gap-3">
                  {isLoggedIn ? (
                    <button className="p-2 hover:bg-gray-100 rounded-lg transition-colors"><User /></button>
                  ) : (
                    <>
                      <button onClick={() => { setAuthMode("signin"); setShowAuthModal(true); }} className="px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">Sign in</button>
                      <button onClick={() => { setAuthMode("register"); setShowAuthModal(true); }} className="px-4 py-2 text-sm font-medium text-white bg-black hover:bg-gray-800 rounded-lg transition-colors">Register</button>
                    </>
                  )}
                  <div className="w-px h-8 bg-gray-300 mx-2" />
                  <button className="p-2 hover:bg-gray-100 rounded-lg transition-colors relative"><ShoppingCart /></button>
                </div>
              </div>
            </div>
            {showAuthModal && (
              <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 animate-in fade-in duration-200">
                <div className="bg-white rounded-2xl shadow-2xl w-full max-w-sm animate-in zoom-in-95 duration-200">
                  <div className="flex items-center justify-between p-6 pb-4">
                    <h2 className="text-xl font-semibold text-gray-800">{authMode === "signin" ? "Iniciar sesi√≥n" : "Registrarse"}</h2>
                    <button onClick={() => setShowAuthModal(false)} className="p-2 hover:bg-gray-100 rounded-full transition-colors"><X /></button>
                  </div>
                  <div className="px-6 pb-6">
                    <div className="space-y-4">
                        {/* --- INICIO DEL BLOQUE NUEVO --- */}
                        {authMode === "register" && (
                            <>
                            <div>
                              <label className="block text-sm font-medium text-gray-700 mb-2">Nombre</label>
                              <input 
                                type="text" 
                                placeholder="Tu Nombre" 
                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black outline-none" 
                                value={nombre} 
                                onChange={e => setNombre(e.target.value)} 
                              />
                            </div>
                            <div>
                              <label className="block text-sm font-medium text-gray-700 mb-2">Apellido</label>
                              <input 
                                type="text" 
                                placeholder="Tu Apellido" 
                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black outline-none" 
                                value={apellido} 
                                onChange={e => setApellido(e.target.value)} 
                              />
                            </div>
                            </>
                        )}
                        {/* --- FIN DEL BLOQUE NUEVO --- */}

                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">Email</label>

                        <input 
  type="email" 
  placeholder="nombre@ejemplo.com" 
  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black outline-none transition-all" 
  value={email} 
  onChange={e => setEmail(e.target.value)} 
/>
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">Contrase√±a</label>
                        <input 
  type="password" 
  placeholder="********" 
  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-black outline-none transition-all" 
  value={pass} 
  onChange={e => setPass(e.target.value)} 
/>
                      </div>
                      <button onClick={handleAuth} className="w-full bg-black text-white py-3 rounded-lg font-medium hover:bg-gray-800 transition-colors mt-6">
                        {authMode === "signin" ? "Iniciar sesi√≥n" : "Registrarse"}
                      </button>
                      {authMode === "signin" && (<div className="text-center mt-4"><button className="text-sm text-gray-600 hover:text-black transition-colors underline">¬øContrase√±a olvidada?</button></div>)}
                      <div className="text-center mt-6 pt-6 border-t border-gray-200">
                        <p className="text-sm text-gray-600">
                          {authMode === "signin" ? "¬øNo tienes cuenta?" : "¬øYa tienes cuenta?"}{" "}
                          <button onClick={() => setAuthMode(authMode === "signin" ? "register" : "signin")} className="text-black font-medium hover:underline">
                            {authMode === "signin" ? "Reg√≠strate" : "Inicia sesi√≥n"}
                          </button>
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            )}
            {menuOpen && (
              <div className="absolute top-16 left-0 w-64 bg-white shadow-lg border-t animate-in slide-in-from-left z-50">
                <nav className="py-2">
                  <a href="#" onClick={(e) => { e.preventDefault(); setCurrentView("home"); setMenuOpen(false); }} className="block px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors">Inicio</a>
                  <a href="#" className="block px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors">Mis pedidos</a>
                  <a href="#" onClick={(e) => { e.preventDefault(); setCurrentView("driverRegister"); setMenuOpen(false); }} className="block px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors">Ser repartidor</a>
                  <a href="#" onClick={(e) => { e.preventDefault(); setCurrentView("help"); setMenuOpen(false); }} className="block px-4 py-3 text-gray-700 hover:bg-gray-100 transition-colors">Ayuda</a>
                </nav>
              </div>
            )}
          </header>
          <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div className="relative rounded-2xl overflow-hidden mb-12 h-64 sm:h-80 animate-in fade-in slide-in-from-bottom-4 duration-700" style={{ animationDelay: '100ms' }}>
              <div className="absolute inset-0 bg-gradient-to-br from-amber-400 via-orange-300 to-amber-200">
                <div className="absolute inset-0 opacity-20">
                  <div className="absolute top-10 right-20 w-32 h-32 bg-white rounded-full blur-3xl"></div>
                  <div className="absolute bottom-20 left-10 w-40 h-40 bg-orange-500 rounded-full blur-3xl"></div>
                </div>
                <div className="absolute bottom-0 left-0 w-full h-full flex items-end justify-start pl-12">
                  <div className="relative w-48 h-64">
                    <div className="absolute top-8 left-12 w-16 h-16 bg-amber-900 rounded-full"></div>
                    <div className="absolute top-20 left-14 w-12 h-8 bg-amber-950 rounded-b-full"></div>
                    <div className="absolute top-24 left-4 w-32 h-40 bg-gradient-to-b from-yellow-500 to-yellow-600 rounded-t-3xl"></div>
                    <div className="absolute top-20 left-8 w-24 h-20 bg-yellow-600 rounded-t-full"></div>
                  </div>
                </div>
              </div>
              <div className="absolute inset-0 bg-gradient-to-r from-black/60 to-transparent" />
              <div className="relative h-full flex flex-col justify-center px-8 sm:px-12">
                <h1 className="text-4xl sm:text-5xl font-bold text-white mb-3 animate-in slide-in-from-left duration-700" style={{ animationDelay: '150ms' }}>
                  Pide tu favor ahora.
                </h1>
                <p className="text-lg sm:text-xl text-white/90 animate-in slide-in-from-left duration-700" style={{ animationDelay: '300ms' }}>
                  Solo pago en efectivo
                </p>
              </div>
            </div>
            {/* INICIO DEL CAMBIO: Grid con dos columnas, la primera se ha eliminado */}
            {/* CAMBIO: Se ajusta el grid para que ahora sea de dos columnas en desktop (md:grid-cols-2) */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
              
              {/* TARJETA 1 (ANTERIORMENTE LA SEGUNDA): Pide favores */}
              <div className="bg-white rounded-xl shadow-sm hover:shadow-md transition-all duration-300 overflow-hidden animate-in fade-in slide-in-from-bottom-4" style={{ animationDelay: '150ms' }}>
                <div className="h-48 relative overflow-hidden bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50">
                  <div className="absolute inset-0 flex items-center justify-center">
                    <div className="relative mr-8">
                      <div className="w-16 h-20 bg-amber-200 rounded-t-full rounded-b-lg transform -rotate-12"></div>
                      <div className="absolute -top-3 left-2 w-3 h-8 bg-amber-200 rounded-full transform -rotate-12"></div>
                      <div className="absolute -top-4 left-5 w-3 h-10 bg-amber-200 rounded-full transform rotate-3"></div>
                      <div className="absolute -top-3 left-8 w-3 h-9 bg-amber-200 rounded-full transform rotate-12"></div>
                      <div className="absolute -top-2 left-11 w-3 h-7 bg-amber-200 rounded-full transform rotate-20"></div>
                      <div className="absolute -bottom-6 left-4 w-8 h-8 bg-amber-300 rounded"></div>
                    </div>
                    <div className="relative ml-8">
                      <div className="w-16 h-20 bg-rose-200 rounded-t-full rounded-b-lg transform rotate-12"></div>
                      <div className="absolute -top-3 right-2 w-3 h-8 bg-rose-200 rounded-full transform rotate-12"></div>
                      <div className="absolute -top-4 right-5 w-3 h-10 bg-rose-200 rounded-full transform -rotate-3"></div>
                      <div className="absolute -top-3 right-8 w-3 h-9 bg-rose-200 rounded-full transform -rotate-12"></div>
                      <div className="absolute -top-2 right-11 w-3 h-7 bg-rose-200 rounded-full transform -rotate-20"></div>
                      <div className="absolute -bottom-6 right-4 w-8 h-8 bg-rose-300 rounded"></div>
                    </div>
                    <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
                      <Hand className="w-8 h-8 text-purple-400 opacity-50 animate-pulse" />
                    </div>
                  </div>
                  <div className="absolute top-8 left-8 w-2 h-2 bg-yellow-400 rounded-full animate-bounce"></div>
                  <div className="absolute top-12 right-12 w-2 h-2 bg-pink-400 rounded-full animate-bounce" style={{ animationDelay: '75ms' }}></div>
                  <div className="absolute bottom-12 left-16 w-2 h-2 bg-blue-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }}></div>
                </div>
                <div className="p-6">
                  <h3 className="text-lg font-semibold text-gray-800 mb-2">
                    Pide favores para mejorar tu comodidad.
                  </h3>
                  <button
                    onClick={() => setCurrentView("newFavor")}
                    className="mt-4 px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors text-sm font-medium"
                  >
                    Pedir favor
                  </button>
                </div>
              </div>
              
              {/* TARJETA 2 (ANTERIORMENTE LA TERCERA): √önete como repartidor */}
              <div className="bg-white rounded-xl shadow-sm hover:shadow-md transition-all duration-300 overflow-hidden animate-in fade-in slide-in-from-bottom-4" style={{ animationDelay: '300ms' }}> 
                {/* Nota: Retraso ajustado para que sea la segunda en aparecer */}
                <div className="h-48 bg-gradient-to-br from-orange-50 to-orange-100 flex items-center justify-center">
                  <UserPlus className="w-32 h-32 text-orange-500" />
                </div>
                <div className="p-6">
                  <h3 className="text-lg font-semibold text-gray-800 mb-2">
                    √önete como repartidor
                  </h3>
                  <p className="text-sm text-gray-600 mb-4">
                    Genera ingresos en tu tiempo libre. S√© tu propio jefe y conectate para repartir cuando y c√≥mo quieras.
                  </p>
                  <button 
                    onClick={() => setCurrentView("driverRegister")} // ***** CAMBIO: Redirecci√≥n al nuevo componente *****
                    className="mt-2 px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors text-sm font-medium"
                  >
                    Quiero trabajar
                  </button>
                </div>
              </div>
              
            </div>
          </main>
        </div>
      );
    }

    // --- Montar la aplicaci√≥n React en el DOM ---
    
    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<HomePage />);
    
  </script>

</body>
</html>